# Autor: Robson Vaamonde
# Site: www.procedimentosemti.com.br
# Facebook: facebook.com/ProcedimentosEmTI
# Facebook: facebook.com/BoraParaPratica
# YouTube: youtube.com/BoraParaPratica
# Linkedin: https://www.linkedin.com/in/robson-vaamonde-0b029028/
# Instagram: https://www.instagram.com/procedimentoem/?hl=pt-br
# Data de criação: 10/10/2021
# Data de atualização: 01/12/2021
# Versão: 0.04
# Testado e homologado para a versão do Ubuntu Server 20.04.x LTS x64

# Configurações Globais do ISC DHCP Server
authoritative;
use-host-decl-names on;
one-lease-per-client on;
allow unknown-clients;
ignore client-updates;
update-static-leases on;
update-optimization off;
update-conflict-detection off;
#
# Configuração do tempo de aluguel dos Endereços IPv4 (minutos) do ISC DHCP Server
default-lease-time 14400;
max-lease-time 18000;
#
# Configuração do Log do ISC DHCP Server em relação ao Rsyslog
log-facility local7;
#
# Configuração do protocolo WPAD (Web Proxy Autodiscovery Protocol) do ISC DHCP Server
# OBS: Essa opção também resolve a falha do Syslog de informações do DHCPINFORM e DHCPACK do Win7
option wpad code 252 = text;
#option wpad "http://172.16.1.20/wpad.dat";
#
# Configurações da integração do Bind9 DNS Server com o ISC DHCP Server
ddns-updates on;
ddns-update-style interim;
option domain-name "pti.intra";
ddns-domainname "pti.intra.";
ddns-rev-domainname "1.16.172.in-addr.arpa.";
#ddns-rev-domainname "in-addr.arpa.";
#
# Configuração da chave de autenticação entre Bind9 DNS Server e o ISC DHCP Server
# Chave gerada com o comando: dnssec-keygen -r /dev/urandom -a HMAC-MD5 -b 128 -n USER vaamonde
# Precisa ser a mesma chave utilizada no arquivo dhcpd.conf e named.conf.local
key rndc-key { 
	algorithm hmac-md5;
	secret vaamonde;
}
# Configuração da Zona de Pesquisa Direta do Bind9 DNS Server
zone pti.intra. {
	primary 172.16.1.20;
	key rndc-key;
}
# Configuração da Zona de Pesquisa Reversa do Bind9 DNS Server
zone 1.16.172.in-addr.arpa. {
	primary 172.16.1.20;
	key rndc-key;
}
#
# Configuração do suporte ao Servidor TFTPD-HPA e Imagem de Boot PXE do ISC DHCP Server
#allow booting;
#allow bootp;
#option option-128 code 128 = string;
#option option-129 code 129 = text;
#next-server 172.16.1.20;
#filename "pxelinux.0";
#
# Configuração do Escopo Padrão da Subrede 172.16.1.0/24
subnet 172.16.1.0 netmask 255.255.255.0 {
	# Range dos endereços IPv4 ofertados na rede
	range 172.16.1.100 172.16.1.200;
	# Máscara de subrede do escopo
	option subnet-mask 255.255.255.0;
	# Endereço de Broadcast da subrede do escopo
	option broadcast-address 172.16.1.255;
	# Endereço de Gateway da subrede do escopo
	option routers 172.16.1.254;
	# Endereço do DNS Server da subrede do escopo
	option domain-name-servers 172.16.1.20;
	# Endereço do NTP Server da subrede do escopo
	option ntp-servers 172.16.1.20;
	# Configuração do UTC Offset da subrede do escopo
	option time-offset -10800;
	# Configuração do Protocolo NetBIOS WINS
	option netbios-name-servers 172.16.1.20;
	option netbios-node-type 2;
	# Desabilitando o WPAD referente a falha do DHCPINFORM e DHCPACK do Win7
	option wpad "\n";
	# Configuração do protocolo WPAD (Web Proxy Autodiscovery Protocol)
	#option wpad code 252 = text;
	#option wpad "http://172.16.1.20/wpad.dat";
	# Configuração do Servidor TFTP-HPA e Imagem de Boot PXE
	#next-server 172.16.1.20;
	#filename "pxelinux.0";
}
#
# Reservando o Endereço IPv4 para um Host na Rede
host ptispo01dt001 {
   # Nome do computador da reserva do escopo
   option host-name "ptispo01dt001.pti.intra";
   # Endereço MAC Address do computador da reserver do escopo
   hardware ethernet 08:00:27:6B:B1:52;
   # Endereço IPv4 fixado/reservado do escopo
   fixed-address 172.16.1.100;
   # Configuração do Servidor TFTP-HPA e Imagem de Boot PXE
   #next-server 172.16.1.20;
   #filename "pxelinux.0";
}
